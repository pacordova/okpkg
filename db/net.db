iptables = {
   url = "https://www.netfilter.org/projects/iptables/files/iptables-1.8.11.tar.xz",
   sha3 = "d3061c9406db2724e9f4c4205de65cc710a5a4c5b5a54876528d1ac02aeb3dcd",
   build = "./configure",
};

connman = {
   url = "https://kernel.org/pub/linux/network/connman/connman-1.44.tar.xz",
   sha3 = "ddd7f92243e94f8450567c263c690d3a360bb87bdba6c9731621343409d78ec0",
   build = "./configure",
   flags = {
      "--enable-{client,datafiles,ethernet,loopback,wifi,wireguard}",
      "--disable-{bluetooth,dundee,gadget,neard,ofono,pacrunner,tools,wispr}",
      "--with-systemdunitdir=no",
      "LIBS=-lncursesw",
   },
   post = [[ 
      install -d $destdir/etc/connman
      install -m 755 client/connmanctl $destdir/usr/bin
      install -m 644 src/main.conf     $destdir/etc/connman
   ]]
};

curl = {
   url = "https://curl.se/download/curl-8.15.0.tar.xz",
   sha3 = "b9a4c78a5a5ed5eda57b5e7b70f9becb214845f7aa69cec3d1b8dff412092098",
   build = "./configure",
   flags = {
      "--enable-{ipv6,threaded-resolver,unix-sockets}",
      "--disable-{ares,ldap,ldaps,manual}",
      "--with-{openssl=yes,libidn2=yes,nghttp2=yes,libssh2=no}",
      "--with-ca-bundle=/etc/ssl/certs/ca-certificates.crt",
   }
};

openntpd = {
   url = "https://ftp.openbsd.org/pub/OpenBSD/OpenNTPD/openntpd-6.8p1.tar.gz",
   sha3 = "05a6c3e7f6928b0455e13e5167f455c1a7d9162cf394d415e6c48da7c49d8eec",
   build = "./configure",
   flags = { "--with-privsep-user=ntp" },
   prepare = [[
      sed -i 's/PRIO_PROCESS, 0, -20/PRIO_PROCESS, 0, 0/' src/ntpd.c
      sed -i ntpd.conf                               \
          -e 's/pool.ntp.org/2.gentoo.pool.ntp.org/' \
          -e '/time.cloudflare.com/d'                \
          -e 's/^constraint/#constraint/g'
   ]]
};

openresolv = {
   url = "https://github.com/NetworkConfiguration/openresolv/releases/download/v3.17.0/openresolv-3.17.0.tar.xz",
   sha3 = "bd1d41ba71ee323a9a589d69bf081f33d647fd9d64187b3065e2a19b0ba3c482",
   build = "./configure",
   flags = { 
      "--libdir=/usr/lib64", 
      "--libexecdir=/usr/lib64", 
      "--sbindir=/usr/bin",
      "--sysconfdir=/etc",
   }
};

iproute2 = {
   url = "https://kernel.org/pub/linux/utils/net/iproute2/iproute2-6.16.0.tar.xz",
   sha3 = "01b5e28b78de7d9435729cdbb138fdc8012266c4d308b2bc7f82c8db8d2346c2",
   build = "./configure",
   flags = { "--libdir=/usr/lib64" },
   prepare = [[
      rm -f man/man8/arpd.8
      sed -e '/ARPD/d' \
          -e 's:/sbin:/usr/bin:' \
          -i Makefile
   ]]
};

iputils = {
   url = "https://github.com/iputils/iputils/releases/download/20250605/iputils-20250605.tar.xz",
   sha3 = "31a2a992c9789d91c29d630d02bbf57cffd09b01911405c27c40a208d160b2fa",
   build = "meson",
   post = [[ chmod u+s $destdir/usr/bin/ping ]],
};

netcat = {
   url = "https://downloads.sourceforge.net/nc110/nc110.20180111.tar.xz",
   sha3 = "98ae44f399eac93e383559e87183dc9bf3080ec928f7d8cb727a5da256272344",
   build = "make",
   flags = { "linux" },
   prepare = [[
      sed -e '/#define HAVE_BIND/s:#define:#undef:' \
          -e '/#define FD_SETSIZE 16/s:16:1024: #34250' \
          -i netcat.c
      : > install
   ]],
   post = [[
      install -d $destdir/usr/{bin,share/man/man1}
      install -m 755 nc   $destdir/usr/bin/
      install -m 644 nc.1 $destdir/usr/share/man/man1/
   ]]
};

openssh = {
   url = "https://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-10.0p1.tar.gz",
   sha3 = "6e49329f6fcf7ab5a1b548022125e1db954d14ca1ee64740dc4cba1c0fcbbffa",
   build = "./configure",
   flags = {
      "--libexecdir=/usr/lib64/ssh",
      "--sysconfdir=/etc/ssh",
      "--with-default-path=/usr/bin",
      "--with-pid-dir=/run",
      "--with-privsep-user=nobody",
      "--with-ssl-engine",
      "--with-xauth=/usr/bin/xauth",
      "--disable-{u,w}tmp",
   },
   post = [[
      install -d $destdir/usr/{bin,share/man/man1}
      install -m 755 contrib/ssh-copy-id   $destdir/usr/bin/
      install -m 644 contrib/ssh-copy-id.1 $destdir/usr/share/man/man1/
   ]]
};

rsync = {
   url = "https://samba.org/ftp/rsync/src/rsync-3.4.1.tar.gz",
   sha3 = "a67ce89d9fcc7cc203ded0b174f01bb24cdd861e44c6c214b44a17435a38e3fa",
   build = "./configure",
   flags = { "--disable-{debug,xxhash}" }
};

sharutils = {
   url = "https://ftp.gnu.org/gnu/sharutils/sharutils-4.15.2.tar.xz",
   sha3 = "9b06bc145640281df912a2af83849621a25a10fb2deb3bd5b1c8561f9c1b53a1",
   build = "./configure",
   flags = { 'CFLAGS="$CFLAGS -Wno-implicit-function-declaration"' },
   prepare = [[
      sed -i 's/BUFSIZ/rw_base_size/' src/unshar.c
      sed -i '/program_name/s/^/extern /' src/*opts.h
      sed -i 's/IO_ftrylockfile/IO_EOF_SEEN/' lib/*.c
      printf "#define _IO_IN_BACKUP 0x100\n" >> lib/stdio-impl.h
   ]]
};

wget = {
   url = "https://ftp.gnu.org/gnu/wget/wget-1.25.0.tar.lz",
   sha3 = "ded3b9f3547aa32926e0257e12ce12992db051c45f6b1125bfad3b3ad5074604",
   build = "./configure",
   flags = { "--with-ssl=openssl" }
};

wpa_supplicant = {
   url = "https://w1.fi/releases/wpa_supplicant-2.11.tar.gz",
   sha3 = "14f105ecef1b2c7734fbefa49a3ac7eed505606fcf0fae3d4d14caaaa982d821",
   build = "make",
   flags = { "-C wpa_supplicant", "BINDIR=/usr/bin", "LIBDIR=/usr/lib64" },
   prepare = [[
      cd wpa_supplicant
      cp defconfig .config
      printf "CONFIG_DEBUG_SYSLOG_FACILITY=LOG_DAEMON\n" >> .config
      printf "CONFIG_IPV6=y\n" >> .config
      printf "CONFIG_READLINE=y\n" >> .config
      printf "CFLAGS += -I/usr/include/libnl3\n" >> .config
      printf "CFLAGS += -Wno-incompatible-pointer-types\n" >> .config
   ]],
   post = [[
      cd wpa_supplicant
      install -d $destdir/usr/bin
      install -d $destdir/usr/share/man/man{5,8}
      install -d $destdir/usr/share/dbus-1/{system-services,system.d}
      install -d $destdir/etc/dbus-1/system.d
      install -m 644 doc/docbook/wpa_supplicant.conf.5 \
          $destdir/usr/share/man/man5/
      install -m 644 doc/docbook/wpa_{cli,passphrase,supplicant}.8 \
          $destdir/usr/share/man/man8/
      install -m 644 dbus/fi.w1.wpa_supplicant1.service \
          $destdir/usr/share/dbus-1/system-services/
      install -m 644 dbus/dbus-wpa_supplicant.conf \
          $destdir/etc/dbus-1/system.d/
   ]]
};
