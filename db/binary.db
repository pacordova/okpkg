zig-bin = {
   url = "https://ziglang.org/download/0.13.0/zig-linux-x86_64-0.13.0.tar.xz",
   sha3 = "60947fd18bcdd206b579ee510db6cdfd3f86d7ac6776ebe9045e13502c259e63",
   post = [[
      install -d $destdir/usr/{bin,lib64}
      install zig $destdir/usr/bin
      cp -rp lib $destdir/usr/lib64/zig
      ln -sf lib64 $destdir/usr/lib
   ]]
};

rust = {
   url = "https://static.rust-lang.org/dist/rust-1.88.0-x86_64-unknown-linux-gnu.tar.xz",
   sha3 = "035a98e19428f4f79d883629ffe44aefbc3e7510687a37358a6f2e51fbb3f5b1",
   build = _,
   post = [[ 
      install -d $destdir/usr
      ./install.sh --destdir=$destdir --prefix=/usr --libdir=$destdir/usr/lib64
      mv $destdir/usr/libexec/* $destdir/usr/lib64
      rmdir $destdir/usr/libexec
      rm -fr $destdir/usr/etc
      : > $destdir/.nostrip
   ]]
};

firefox = {
   url = "https://download-installer.cdn.mozilla.net/pub/firefox/releases/140.0.4/linux-x86_64/en-US/firefox-140.0.4.tar.xz",
   sha3 = "f14570fd18fcd8683cc1605e984f0b7dc72f9b3bb48a41d1dd72737dbca81bcf",
   build = _,
   post = [[
      install -d $destdir/usr/{bin,lib64}
      install -d $destdir/usr/share/applications
      install ../../download/firefox.desktop $destdir/usr/share/applications
      cp -rp . $destdir/usr/lib64/firefox
      ln -sf /usr/lib64/firefox/firefox $destdir/usr/bin/firefox
      cd $destdir/usr/lib64/firefox
      for f in *.so; do ln -sf firefox/$f ..; done
   ]]
};

-- from firefox: libnss3.so libnssutil3.so libsmime3.so libnspr4.so libplc4.so libplds4.so
-- needs libcups.so.2
discord = {
   url = "https://dl.discordapp.net/apps/linux/0.0.102/discord-0.0.102.tar.gz",
   sha3 = "d6aca26872e39ebdfafd13de20619ca6418aa9b58cf11bab57d35da4b5e6faa2",
   build = _,
   post = [[
      sed -e 's:/usr/share:/usr/lib64:'                         \
          -e 's:^Icon=.*$:Icon=/usr/lib64/discord/discord.png:' \
          -i discord.desktop
      install -d $destdir/usr/{bin,lib64}
      install -d $destdir/usr/share/applications  
      install -m 644 discord.desktop $destdir/usr/share/applications
      cp -rp . $destdir/usr/lib64/discord
      ln -sf /usr/lib64/discord/Discord $destdir/usr/bin/discord
   ]]
};

libreoffice-bin = {
   url = "https://download.documentfoundation.org/libreoffice/stable/25.2.3/deb/x86_64/LibreOffice_25.2.3_Linux_x86-64_deb.tar.gz",
   sha3 = "0ec180fb759cca7c76d260e6f7078ef93413293c4ae7daad5c6006897d319b52",
   build = _,
   post = [[
      find DEBS -name '*.deb' -exec ar x '{}' data.tar.xz \; -exec tar -xf data.tar.xz \;
      version=`basename opt/*`
      install -d $destdir/usr/{bin,lib64}
      cp -rp  opt/* $destdir/usr/lib64
      cp -rp  usr/share $destdir/usr/share
      ln -sfr $destdir/usr/lib64/$version/program/soffice $destdir/usr/bin/$version
      ln -sf  $version $destdir/usr/bin/libreoffice
      ln -sf  $soffice $destdir/usr/bin/soffice
      cd $destdir/usr/share/applications
      for x in base calc draw impress math startcenter writer xsltfilter
      do
          ln -sf /usr/lib64/$version/share/xdg/$x.desktop $version-$x.desktop
          sed -i "s|Icon=$version|Icon=libreoffice|" $version-$x.desktop
      done
   ]]
};

-- TOFU
tinytex = {
   url = "https://github.com/rstudio/tinytex-releases/releases/download/v2024.07.03/TinyTeX-1-v2024.07.03.tar.gz",
   sha3 = "b6d573122dc97c5085993f707f439f07e3ac18dee500e6a0c8bb9250997e3385",
   build = _,
   post = [[
      install -d $destdir/usr/{bin,lib64}
      cp -rp . $destdir/usr/lib64/TinyTeX
      find $destdir/usr/lib64/TinyTeX/bin/* -type f \
           -exec ln -sfr '{}' $destdir/usr/bin \;
   ]] 
};

nodejs = {
   url = "https://nodejs.org/dist/v22.6.0/node-v22.6.0-linux-x64.tar.xz",
   sha3 = "82b4d018232a302d7a00d64e8c7d2e0b0db83958d680930b57d5080fdb1009c4",
   build = _,
   post = [[
      install -d $destdir/usr
      cp -rp share bin lib include $destdir/usr        
      mv $destdir/usr/lib $destdir/usr/lib64
   ]]
};

-- TODO: download error: cannot handle debfile
-- Consider building from source.
signal-desktop = {
   url = "https://updates.signal.org/desktop/apt/pool/s/signal-desktop/signal-desktop_7.62.0_amd64.deb",
   sha3 = "272d1efd35242ac2caed096d9d9cb223cefa6890be33bfdd6b7f8e1516dbc712",
   build = _,
   post = [[
      ar x ../../download/signal-desktop_7.62.0_amd64.deb data.tar.xz
      tar -xf data.tar.xz
      sed -i 's:/opt/Signal:/usr/bin:' usr/share/applications/signal-desktop.desktop
      install -d $destdir/usr/{lib64,bin}
      cp -rp usr/share  $destdir/usr/share
      cp -rp opt/Signal $destdir/usr/lib64/signal-desktop
      ln -sf /usr/lib64/signal-desktop/signal-desktop $destdir/usr/bin/signal-desktop
   ]]
};

llvm-bin = {
   url = "https://github.com/llvm/llvm-project/releases/download/llvmorg-19.1.0/LLVM-19.1.0-Linux-X64.tar.xz",
   sha3 = "dc589f728138402247a983b8b92e857efc2b1abd87ef93396b9bc1946fae5f49",
   build = _,
   post = [[
      install -d $destdir/usr
      cp -rp bin include share $destdir/usr/
      cp -rp lib $destdir/usr/lib64
   ]]
};

cmake-bin = {
   url = "https://github.com/Kitware/CMake/releases/download/v3.30.3/cmake-3.30.3-linux-x86_64.tar.gz", 
   sha3 = "226606c986f6d544b7a9ba2e968ae3a563f6b2585cfcbf996895ee02f10b1e31",
   build = _,
   post = [[
      install -d $destdir/usr/bin $destdir/usr/share/man/man{1,7}
      install -m 755 bin/* $destdir/usr/bin
      install -m 644 man/man1/*.1 $destdir/usr/share/man/man1
      install -m 644 man/man7/*.7 $destdir/usr/share/man/man7
      cp -rp share/cmake* share/aclocal $destdir/usr/share
   ]]
};

-- TODO: cannot handle zipfile
brave-bin = {
   url = "https://github.com/brave/brave-browser/releases/download/v1.61.120/brave-browser-1.61.120-linux-amd64.zip",
   sha3 = _,
   build = _,
   post = [[
      install -d $destdir/usr/{bin,lib64}
      cp -rp . $destdir/usr/lib64/brave
      ln -sf /usr/lib64/brave/brave-browser $destdir/usr/bin/brave
   ]]
};

ungoogled-chromium-bin = {
   url = "https://github.com/ungoogled-software/ungoogled-chromium-portablelinux/releases/download/126.0.6478.182-1/ungoogled-chromium_126.0.6478.182-1_linux.tar.xz",
   sha3 = "9a5fb02463263f6a7d2a0c57d46602c7a01511fda430b47b072afaf1370b063b",
   build = _,
   post = [[
      install -d $destdir/usr/{bin,lib64}
      cp -rp . $destdir/usr/lib64/chromium
      ln -sf /usr/lib64/chromium/chrome $destdir/usr/bin/chromium
   ]] 
};
